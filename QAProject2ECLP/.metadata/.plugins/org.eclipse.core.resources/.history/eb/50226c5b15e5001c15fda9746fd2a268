package com.qa.SpringbootExample.controllers;

import org.junit.jupiter.api.Test;
import org.springframework.beans.factory.annotation.Autowired;
import org.springframework.boot.test.autoconfigure.web.servlet.AutoConfigureMockMvc;
import org.springframework.boot.test.context.SpringBootTest;
import org.springframework.test.context.ActiveProfiles;
import org.springframework.test.context.jdbc.Sql;
import org.springframework.test.context.jdbc.Sql.ExecutionPhase;
import org.springframework.test.web.servlet.MockMvc;

import com.fasterxml.jackson.databind.ObjectMapper;
import com.qa.SpringbootExample.domain.Creature;

public class CreatureControllerIntegrationTests {

	@SpringBootTest
	@AutoConfigureMockMvc
	@Sql(scripts = {"classpath:testschema.sql", "classpath:testdata.sql"}, executionPhase = ExecutionPhase.BEFORE_TEST_METHOD)
	@ActiveProfiles("test")
	public class UserControllerIntegrationTest {

		@Autowired
		private MockMvc mvc;
		
		@Autowired
		private ObjectMapper mapper;

		@Test
		public void createTest() throws Exception {
			Creature input = new Creature("Jim", "Jones", "jjones1");
			String inputAsJSON = mapper.writeValueAsString(input);
			
			Creature output = new Creature(2L, "Creature2",22,22,22,"Notes2");
			String outputAsJSON = mapper.writeValueAsString(output);
			
			mvc.perform(post("/user/create")
					.contentType(MediaType.APPLICATION_JSON)
					.content(inputAsJSON))
					.andExpect(status().isCreated())
					.andExpect(content().json(outputAsJSON)); 
			
		}
	
	
}
